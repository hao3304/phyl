{
    "version": 3,
    "sources": [
        "../../../src/home/controller/staff.js"
    ],
    "names": [],
    "mappings": "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",
    "file": "../../../src/home/controller/staff.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base.js';\nlet fs = require(\"fs\");\n\nexport default class extends Base {\n  /**\n   * before magic method\n   * @return {Promise} []\n   */\n  async __before(){\n    let userinfo = await this.session(\"userinfo\");\n    if(think.isEmpty(userinfo)){\n      return this.fail(\"没有权限\");\n    }else if(userinfo.type !=\"staff\"){\n      return this.fail(\"没有权限\");\n    }\n  }\n\n\n  async getAction(){\n    let model = this.model(\"staff\");\n    let data;\n    if(this.id){\n      data = await model.find({_id:this.id});\n    }else{\n      data = await model.page(this.get(\"page\")).countSelect();\n    }\n    return this.success(data);\n  }\n\n  /**\n   *  更换头像\n   */\n  async headpicAction(){\n    if(this.isAjax(\"put\")){\n      let userinfo = await this.session(\"userinfo\");\n      let data = this.post();\n      if(think.isEmpty(data)){\n        return this.fail(\"data is empty\");\n      }\n      let m = await this.model(\"staff\").where({_id:userinfo._id}).find();\n      if(!think.isEmpty(m)){\n        fs.unlink(think.UPLOAD_PATH +\"/\"+ m.avatar.replace(\"/upload\",\"\"));\n      }\n      let path = \"/upload/\"+data.pid;\n      let row = await this.model(\"staff\").where({_id:userinfo._id}).update({avatar:path});\n      return this.success(path);\n    }\n  }\n\n  async addpicAction(){\n    if(this.isAjax(\"put\")){\n      let userinfo = await this.session(\"userinfo\");\n      let data = this.post();\n      if(think.isEmpty(data)){\n        return this.fail(\"data is empty\");\n      }\n      let row = await this.model(\"staff\").addPic(userinfo._id,data.pid);\n      return this.success(row);\n    }\n  }\n\n  async delpicAction(){\n    let pid = this.get(\"id\");\n    if(pid){\n      let userinfo = await this.session(\"userinfo\");\n      let row = await this.model(\"staff\").where({_id:userinfo._id}).update({$pull: {\"pics\": pid}});\n      if(row){\n        fs.unlink(think.UPLOAD_PATH +\"/\"+pid);\n      }\n      return this.success(row);\n    }else{\n      return this.fail(\"data in empty\");\n    }\n  }\n\n  /**\n   * 修改状态\n   * @returns {*}\n     */\n  async stateAction(){\n\n    if(this.isAjax(\"put\")){\n      let userinfo = await this.session(\"userinfo\");\n      let data = this.post();\n      if(!data&&data.state){\n        return this.fail(\"data is empty\");\n      }\n      let row = await this.model(\"staff\").updateStaff(userinfo._id,{state:data.state});\n      let oauth = this.controller(\"oauth\");\n\n      oauth.sendMsg({\n        \"touser\": userinfo.userid\n      },{\n        \"msgtype\": \"text\",\n        \"text\": {\n          \"content\": data.msg\n        },\n        \"safe\":\"0\"\n      });\n      return this.success(row);\n    }\n  }\n\n  async updateAction(){\n\n    if(this.isAjax(\"put\")){\n      let data = this.post();\n      let auth = [\"name\",\"age\",\"desc\",\"weight\",\"height\",\"mobile\"];\n      let canbe = true;\n      for(var i in data){\n        if(auth.indexOf(i) == -1){\n          canbe = false;\n        }\n      }\n\n      if(canbe){\n        let model = this.model(\"staff\");\n        let user = await this.session(\"userinfo\");\n        let row = await model.where({_id:user._id}).update(data);\n        return this.success(row);\n      }else{\n        return this.fail(\"没有权限\");\n      }\n\n      return this.fail(\"不支持请求类型\");\n    }\n  }\n\n}"
    ]
}